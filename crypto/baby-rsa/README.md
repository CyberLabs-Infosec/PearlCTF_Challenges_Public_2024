# Baby's Message Out

```
Baby's first steps are important, so I increased the number of primes.
```

Going through the source file given leads us to the following conclusions. This is a typical multi-prime rsa technique with the number of primes increased.

```python
def nextPrime(p):
    if isPrime(p):
        return p
    else:
        return nextPrime(p + 61)
```

This function gives another prime $p_1$ which is an integer multiple of $61$ away from $p$. We can write $p_1 = p + 61\cdot k$ for some $k << p$. Since $p$ is several hundred orders of magnitude greater than $61\cdot k$, we can approximate $p_1$ as $p$. This is the key to the problem.

So, in general, $\text{nextPrime}(p) \approx p$.

```python
p = getPrime(256)
q = nextPrime(nextPrime(17*p + 1) + 3)
r = nextPrime(29*p*q)
s = nextPrime(q*r + p)
t = nextPrime(r*s*q)
```

This all simplifies to
$q \approx 17p \\
r \approx 29pq \approx 29\cdot 17p^2 \\
s \approx qr \approx 17p\cdot29\cdot17p^2 \approx 29\cdot17^2 p^3 \\
t\approx rsq \approx 29\cdot 17p^2 \cdot 29\cdot 17^2 p^3 \cdot 17p = 29^2\cdot17^4p^6\\
n = pqrst \approx 29^4\cdot17^8p^{13}$

One can then find the approximate value of $p \approx \sqrt[13]{\dfrac{n}{29^4\cdot17^8}}$
We have now got the approximate value of $p$, now we just need to apply binary search to find the real value of $p$. 

```python
from Crypto.Util.number import isPrime, long_to_bytes
from gmpy2 import next_prime, iroot
import sys
sys.setrecursionlimit(pow(10,5))

def prev_prime(p):
    p -= 1
    while True:
        if isPrime(p):
            return p
        else:
            p -= 1

def nextPrime(p):
    if isPrime(p):
        return p
    else:
        return nextPrime(p+61)

def primesgen(p):
    q = nextPrime(nextPrime(17*p+1)+3)
    r = nextPrime(29*p*q)
    s = nextPrime(q*r+p)
    t = nextPrime(r*s*q)
    return p*q*r*s*t

def find_p(p_approx,n):
    while True:
        n_approx = primesgen(p_approx)
        if n_approx > n:
            p_approx = prev_prime(p_approx)
        elif n_approx < n:
            p_approx = next_prime(p_approx)
        else:
            return p_approx

n = 485889862688353809145356849681869098056742135790325154633816315764783289109350404808839464043297429168130293002483316664607770068196944445394490388957147529192164743228508084885030734914365245916125607677185307000076761646830755541107131137865984020648243428286711853728051263128076845261298240617545417811431124904304446607845470628505361436115651109768237103000946120781642652665829238385087624612205525857191218811570122228639908283598707567056620352822139985271817003262919597858495812801663331842855143930997258260164422858382713240717739568744168349527025412634588705503126870149875268600539407786323924132037483972529603572727892740460450963315253482630345996561505957763886776070413535287129043703855880444326909520084249767518737040222995586717034060176093473694948961503759770499124924886087468497100053775745634680192678426965540847613838559522315570932873854027804486662281273550134766570419630624914801192395060568099367828616501877701994364906741451132770474154689411119296104818089636891131318495955929
p_approx = iroot(n//(pow(17,8)*pow(29,4)),13)[0]
p = find_p(p_approx,n)

q = nextPrime(nextPrime(17*p+1)+3)
r = nextPrime(29*p*q)
s = nextPrime(q*r+p)
t = nextPrime(r*s*q)

phi = (p-1)*(q-1)*(r-1)*(s-1)*(t-1)
e = 65537
d = pow(e,-1,phi)
c = 1838979268925267202615818395622122484893202706167722156383681963142079180161531237936585341507802530813847301831886857107840552940103096671213346624172927405178565892385733216702672851783423891229382579221604596673156151519463795808010572632138076246765227545034269340790242411584582692558549837221897037971538915332866933837117883228953143242965510280921618063635225603250391037969273250144174802927111408106890496901519737395485115788436384012937788617630381389196078818501905993385084557887716148781944416313908553565974546239241287340505018036547080504009483360838747251073440799502791555942879229132369697126614944991347408598924472158561247485575276852356316968119522601927483600978106155875300324966339458896992260918634629607740522754923275555209240690069838566642421234035117257380757518902549668151860260985363114235340791362277047923494577018035035653075155240898800910887230020812289524262582877697129108304758256250595391379019020972909027192107727799235384374670082518555887502478560056865020860127002
m = pow(c,d,n)

print(long_to_bytes(m))
```
The flag is `pearl{7h1s_0n3_w4s_f0r_7h3_k1ds}`

